<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Uklon — Перевірка розрахунків</title>

<style>
  :root{
    --bg:#f2f4f7;
    --card:#ffffff;
    --accent:#0066ff;
    --green:#c8f5c2;
    --red:#ffd4d4;
    --good:#0c7a27;
    --bad:#a80000;
    --muted:#6b6b6b;
  }

  body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
    background:var(--bg);
    margin:0;
    padding:0;
  }

  .wrap{max-width:600px;margin:0 auto;padding:16px;}
  h1{text-align:center;margin:0 0 16px;font-size:22px;font-weight:700;}

  .card{
    background:var(--card);
    border-radius:16px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    margin-bottom:16px;
  }

  label{font-size:15px;color:var(--muted);margin-bottom:6px;display:block;}

  input[type="number"]{
    width:100%;
    padding:14px 12px;
    font-size:18px;
    border-radius:12px;
    border:1px solid #d8dce3;
    margin-bottom:12px;
    box-sizing:border-box;
  }

  input[type="number"]:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(0,102,255,0.2);
  }

  .btn{
    width:100%;
    padding:14px;
    border-radius:12px;
    background:var(--accent);
    border:0;
    color:white;
    font-size:18px;
    font-weight:600;
  }

  .results{display:flex;flex-direction:column;gap:16px;}

  .panel{
    background:#fff;
    border-radius:16px;
    padding:16px;
    border:1px solid #e7e9ee;
  }

  .panel h3{margin:0 0 10px;font-size:18px;}

  .line{
    display:flex;
    justify-content:space-between;
    padding:8px 0;
    font-size:16px;
    border-top:1px solid #eee;
  }
  .line:first-of-type{border-top:0;padding-top:0;}

  .val{font-weight:700;}

  .diff{
    padding:6px 12px;
    border-radius:10px;
    min-width:90px;
    text-align:center;
    display:inline-block;
    font-weight:600;
  }

  .zero{
    background:#f4f4f4;
    border:1px dashed #ccc;
    color:#555;
  }

  textarea{
  width: 94%;
  max-width: 94%;
  margin: 10px auto 0 auto;   /* ← выравнивание по центру */
  height: 140px;
  border-radius: 10px;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ddd;
  box-sizing: border-box;
  display: block;             /* ← обязательно */
}

  .row{display:flex;gap:10px;}
  .small-btn{padding:8px 12px;border-radius:8px;border:0;background:#eee;cursor:pointer}
</style>
</head>

<body>
<div class="wrap">
  <h1>Перевірка розрахунків Uklon</h1>

  <div class="card">
    <label>Фактична сума, грн</label>
    <input id="actual" type="number" inputmode="decimal" placeholder="наприклад 155">

    <label>Пробіг, км</label>
    <input id="distance" type="number" inputmode="decimal" step="0.01" placeholder="наприклад 3.0">

    <label>Коефіцієнт</label>
    <input id="coef" type="number" inputmode="decimal" step="0.01" placeholder="наприклад 1.06">

    <button class="btn" id="calcBtn">Розрахувати</button>
  </div>

  <div class="results">

    <div class="panel">
      <h3>Стандарт</h3>
      <div class="line"><span>Розрахункова сума</span><span class="val" id="stdCalc">—</span></div>
      <div class="line"><span>Різниця</span><span class="diff zero" id="stdDiff">—</span></div>
      <textarea id="stdMsg" placeholder="Повідомлення для оператора зʼявиться тут"></textarea>
      <button class="small-btn" id="copyStd">Копіювати</button>
    </div>

    <div class="panel">
      <h3>Комфорт</h3>
      <div class="line"><span>Розрахункова сума</span><span class="val" id="cfCalc">—</span></div>
      <div class="line"><span>Різниця</span><span class="diff zero" id="cfDiff">—</span></div>
      <textarea id="cfMsg" placeholder="Повідомлення для оператора зʼявиться тут"></textarea>
      <button class="small-btn" id="copyCf">Копіювати</button>
    </div>

    <div class="panel">
      <h3>Бізнес</h3>
      <div class="line"><span>Розрахункова сума</span><span class="val" id="bizCalc">—</span></div>
      <div class="line"><span>Різниця</span><span class="diff zero" id="bizDiff">—</span></div>
      <textarea id="bizMsg" placeholder="Повідомлення для оператора зʼявиться тут"></textarea>
      <button class="small-btn" id="copyBiz">Копіювати</button>
    </div>

  </div>
</div>

<script>
const STD = {minKm:1.9, base:100, perKm:17.6, name:"Стандарт"};
const CFM = {minKm:2.1, base:115, perKm:19.8, name:"Комфорт"};
const BIZ = {minKm:1.6, base:140, perKm:23.5, name:"Бізнес"};

function calcFare(km, t){
  if(km <= t.minKm) return t.base;
  return t.base + (km - t.minKm) * t.perKm;
}

function buildMessage(t, km, coef, fact, calc){
return `Тариф: ${t.name}
Пробіг: ${km} км
Коефіцієнт: x${coef}
Сплачено: ${fact} грн

Мінімальна ціна: ${t.base} грн за ${t.minKm} км
Ціна за км: ${t.perKm} грн
Розрахунок: ${calc.toFixed(2)} грн
Різниця: ${(calc - fact).toFixed(2)} грн

Прошу перевірити коректність нарахування та виконати перерахунок.`;
}

function fmt(x){return isNaN(x) ? "—" : x.toFixed(2) + " ₴";}

function colorize(el, v){
  el.className="diff";
  if(isNaN(v)){el.classList.add("zero"); el.textContent="—"; return;}
  el.textContent=v.toFixed(2)+" ₴";

  if(v>0){el.style.background="var(--green)"; el.style.color="var(--good)";}
  else if(v<0){el.style.background="var(--red)"; el.style.color="var(--bad)";}
  else el.classList.add("zero");
}

document.getElementById("calcBtn").onclick = function(){
  let actual = parseFloat(document.getElementById("actual").value);
  let km = parseFloat(document.getElementById("distance").value);
  let coef = parseFloat(document.getElementById("coef").value);

  if(isNaN(km) || isNaN(coef) || isNaN(actual)){
    alert("Введіть коректні дані");
    return;
  }

  // base and total
  const stdBase = calcFare(km, STD);
  const cfBase = calcFare(km, CFM);
  const bizBase = calcFare(km, BIZ);

  const stdTotal = stdBase * coef;
  const cfTotal = cfBase * coef;
  const bizTotal = bizBase * coef;

  // display totals
  document.getElementById("stdCalc").textContent = fmt(stdTotal);
  document.getElementById("cfCalc").textContent = fmt(cfTotal);
  document.getElementById("bizCalc").textContent = fmt(bizTotal);

  // differences for coloring (actual - calc): positive => переплата (green)
  const dStd = actual - stdTotal;
  const dCf = actual - cfTotal;
  const dBiz = actual - bizTotal;

  colorize(document.getElementById("stdDiff"), dStd);
  colorize(document.getElementById("cfDiff"), dCf);
  colorize(document.getElementById("bizDiff"), dBiz);

  // prepare breakdown strings (show full calculation) and messages only when calc > actual
  function breakdownString(base, t){
    if(km <= t.minKm) return `${t.base} × ${coef}`;
    return `(${t.base} + (${km} - ${t.minKm}) × ${t.perKm}) × ${coef}`;
  }

  function genMsg(name, calcTotal){
    const diff = calcTotal - actual; // positive means customer недоплатив
    if(!(diff > 0)) return "";
    const breakdown = breakdownString(null, name === STD.name ? STD : (name === CFM.name ? CFM : BIZ));
    return `Доброго дня! Прошу провести перерахунок вартості поїздки.
Розрахункова сума становить ${calcTotal.toFixed(2)} грн (${breakdown}).
Фактична — ${actual.toFixed(2)} грн.
Прошу донарахувати різницю у розмірі ${diff.toFixed(2)} грн.`;
  }

  // fill messages (only if calc > actual)
  document.getElementById('stdMsg').value = genMsg(STD.name, stdTotal);
  document.getElementById('cfMsg').value = genMsg(CFM.name, cfTotal);
  document.getElementById('bizMsg').value = genMsg(BIZ.name, bizTotal);

  // copy buttons
  function copyIfNotEmpty(btnId, taId){
    document.getElementById(btnId).onclick = function(){
      const t = document.getElementById(taId);
      if(!t.value){ alert('Немає повідомлення для копіювання'); return; }
      t.select();
      t.setSelectionRange(0, 99999);
      try{ navigator.clipboard.writeText(t.value); alert('Скопійовано'); }
      catch(e){ document.execCommand('copy'); alert('Скопійовано'); }
    };
  }

  copyIfNotEmpty('copyStd', 'stdMsg');
  copyIfNotEmpty('copyCf', 'cfMsg');
  copyIfNotEmpty('copyBiz', 'bizMsg');
};

</script>
</body>
</html>
